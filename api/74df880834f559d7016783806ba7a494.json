{"title":"RxSwift (äºŒ) Working with Subjects","slug":"RxSwift (äºŒ) Working with Subjects","url":"http://share.ra.com/RxSwift (äºŒ) Working with Subjects","date":"2017-03-22T06:09:33.000Z","updated":"2017-03-22T06:35:00.000Z","comments":true,"excerpt":"","tags":["Swift","RxSwift"],"content":"<p>é¦–å…ˆåœ¨playground ä¸­ç»™ObervableTypeå¢åŠ ä¸€ä¸ªæ‰©å±•ã€‚æ–¹ä¾¿æŸ¥çœ‹å­ç±»è®¢é˜…æ—¶å‘ç”Ÿçš„å˜åŒ–</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\"><span class=\"class\"><span class=\"keyword\">extension</span> <span class=\"title\">ObservableType</span></span>&#123;</div><div class=\"line\"></div><div class=\"line\">    <span class=\"comment\">///ç»™æ¯ä¸€ä¸ªè§‚å¯Ÿè€…å¢åŠ ä¸€ä¸ªidã€‚å¹¶æ‰“å°idå’Œå‘å°„çš„äº‹ä»¶</span></div><div class=\"line\">    <span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">addObservable</span><span class=\"params\">(<span class=\"number\">_</span> id:String)</span></span> -&gt; <span class=\"type\">Disposable</span> &#123;</div><div class=\"line\">        </div><div class=\"line\">        <span class=\"keyword\">return</span> subscribe&#123;</div><div class=\"line\">        </div><div class=\"line\">            <span class=\"built_in\">print</span>(<span class=\"string\">\"Subscription:\"</span>, id, <span class=\"string\">\"Event:\"</span>, $<span class=\"number\">0</span>)</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"></div><div class=\"line\"><span class=\"function\"><span class=\"keyword\">func</span> <span class=\"title\">writeSequenceToConsole</span>&lt;O: ObservableType&gt;<span class=\"params\">(name: String, sequence: O)</span></span> -&gt; <span class=\"type\">Disposable</span> &#123;</div><div class=\"line\">    <span class=\"keyword\">return</span> sequence.subscribe &#123; event <span class=\"keyword\">in</span></div><div class=\"line\">        <span class=\"built_in\">print</span>(<span class=\"string\">\"Subscription: <span class=\"subst\">\\(name)</span>, event: <span class=\"subst\">\\(event)</span>\"</span>)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<h2 id=\"PublishSubject\"><a href=\"#PublishSubject\" class=\"headerlink\" title=\"PublishSubject\"></a>PublishSubject</h2><p>PublishSubjectåªä¼šæŠŠåœ¨è®¢é˜…å‘ç”Ÿçš„æ—¶é—´ç‚¹ä¹‹åæ¥è‡ªåŸå§‹Observableçš„æ•°æ®å‘å°„ç»™è§‚å¯Ÿè€…ã€‚</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div></pre></td><td class=\"code\"><pre><div class=\"line\">exampleOf(description: <span class=\"string\">\"PublishSubject\"</span>) &#123; </div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> disposeBag = <span class=\"type\">DisposeBag</span>()</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> publishSubject = <span class=\"type\">PublishSubject</span>&lt;<span class=\"type\">String</span>&gt;()</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">///ç¬¬ä¸€ç»„</span></div><div class=\"line\">    publishSubject.addObservable(<span class=\"string\">\"no.1\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    publishSubject.onNext(<span class=\"string\">\"2\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    publishSubject.onNext(<span class=\"string\">\"3\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"comment\">//ç¬¬äºŒç»„</span></div><div class=\"line\">    publishSubject.addObservable(<span class=\"string\">\"no.2\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    publishSubject.onNext(<span class=\"string\">\"ğŸ±\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    publishSubject.onNext(<span class=\"string\">\"ğŸ¶\"</span>)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>æ‰“å°ç»“æœå¦‚ä¸‹</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div></pre></td><td class=\"code\"><pre><div class=\"line\">------exampleOf:<span class=\"type\">PublishSubject</span>------</div><div class=\"line\"><span class=\"type\">Subscription</span>: no.<span class=\"number\">1</span> <span class=\"type\">Event</span>: next(<span class=\"number\">2</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: no.<span class=\"number\">1</span> <span class=\"type\">Event</span>: next(<span class=\"number\">3</span>)</div><div class=\"line\"><span class=\"type\">Subscription</span>: no.<span class=\"number\">1</span> <span class=\"type\">Event</span>: next(ğŸ±)</div><div class=\"line\"><span class=\"type\">Subscription</span>: no.<span class=\"number\">2</span> <span class=\"type\">Event</span>: next(ğŸ±)</div><div class=\"line\"><span class=\"type\">Subscription</span>: no.<span class=\"number\">1</span> <span class=\"type\">Event</span>: next(ğŸ¶)</div><div class=\"line\"><span class=\"type\">Subscription</span>: no.<span class=\"number\">2</span> <span class=\"type\">Event</span>: next(ğŸ¶)</div></pre></td></tr></table></figure>\n<p>å¯ä»¥çœ‹no.2 å¹¶æ²¡æœ‰æ”¶åˆ°no.2è®¢é˜…ä¹‹å‰å‘é€çš„ä¿¡å·ï¼ˆ2å’Œ3ï¼‰ã€‚</p>\n<h2 id=\"ReplaySubject\"><a href=\"#ReplaySubject\" class=\"headerlink\" title=\"ReplaySubject\"></a>ReplaySubject</h2><p>ReplaySubjectä¼šå‘å°„æ‰€æœ‰æ¥è‡ªåŸå§‹Observableçš„æ•°æ®ç»™è§‚å¯Ÿè€…ï¼Œæ— è®ºå®ƒä»¬æ˜¯ä½•æ—¶è®¢é˜…çš„ã€‚ä¹Ÿ æœ‰å…¶å®ƒç‰ˆæœ¬çš„ReplaySubjectï¼Œåœ¨é‡æ”¾ç¼“å­˜å¢é•¿åˆ°ä¸€å®šå¤§å°çš„æ—¶å€™æˆ–è¿‡äº†ä¸€æ®µæ—¶é—´åä¼šä¸¢å¼ƒæ—§ çš„æ•°æ®(åŸå§‹Observableå‘å°„çš„)ã€‚</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div><div class=\"line\">19</div><div class=\"line\">20</div><div class=\"line\">21</div></pre></td><td class=\"code\"><pre><div class=\"line\">exampleOf(description: <span class=\"string\">\"replaySubject\"</span>) &#123; </div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> disposeBag = <span class=\"type\">DisposeBag</span>()</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> replaySubject = <span class=\"type\">ReplaySubject</span>&lt;<span class=\"type\">String</span>&gt;.create(bufferSize: <span class=\"number\">2</span>)</div><div class=\"line\">    </div><div class=\"line\">    replaySubject.addObservable(<span class=\"string\">\"no.1\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    replaySubject.onNext(<span class=\"string\">\"ç¬¬ä¸€ä¸ªäº‹ä»¶\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    replaySubject.onNext(<span class=\"string\">\"ç¬¬äºŒä¸ªäº‹ä»¶\"</span>)</div><div class=\"line\"></div><div class=\"line\">    </div><div class=\"line\">    </div><div class=\"line\">    replaySubject.addObservable(<span class=\"string\">\"no.2\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    replaySubject.onNext(<span class=\"string\">\"3\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    replaySubject.onNext(<span class=\"string\">\"4\"</span>)</div><div class=\"line\">    </div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>æ‰“å°ç»“æœå¦‚ä¸‹</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">------exampleOf:replaySubject------</div><div class=\"line\">Subscription: no.1 Event: next(ç¬¬ä¸€ä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: no.1 Event: next(ç¬¬äºŒä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: no.2 Event: next(ç¬¬ä¸€ä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: no.2 Event: next(ç¬¬äºŒä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: no.1 Event: next(3)</div><div class=\"line\">Subscription: no.2 Event: next(3)</div><div class=\"line\">Subscription: no.1 Event: next(4)</div><div class=\"line\">Subscription: no.2 Event: next(4)</div></pre></td></tr></table></figure>\n<p>ä¼šå°†è®¢é˜…ä¹‹å‰çš„ä¿¡å·å‘ç»™æ–°è®¢é˜…è€…ã€‚å¦‚æœæŒ‡å®šäº†buttersize,ä¼šæ ¹æ®buttersizeï¼ˆæˆ‘ç†è§£ä¸ºå¤šå°‘ä¸ªï¼‰å‘é€ä¹‹å‰çš„æ•°æ®</p>\n<h2 id=\"BehaviorSubject\"><a href=\"#BehaviorSubject\" class=\"headerlink\" title=\"BehaviorSubject\"></a>BehaviorSubject</h2><p>å½“è§‚å¯Ÿè€…è®¢é˜…BehaviorSubjectæ—¶ï¼Œå®ƒå¼€å§‹å‘å°„åŸå§‹Observableæœ€è¿‘å‘å°„çš„æ•°æ®(å¦‚æœæ­¤æ—¶è¿˜ æ²¡æœ‰æ”¶åˆ°ä»»ä½•æ•°æ®ï¼Œå®ƒä¼šå‘å°„ä¸€ä¸ªé»˜è®¤å€¼)ï¼Œç„¶åç»§ç»­å‘å°„å…¶å®ƒä»»ä½•æ¥è‡ªåŸå§‹Observableçš„ æ•°æ®ã€‚</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">exampleOf(description: <span class=\"string\">\"BehaviorSubject\"</span>) &#123; </div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> disposeBag = <span class=\"type\">DisposeBag</span>()</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> subject = <span class=\"type\">BehaviorSubject</span>(value: <span class=\"string\">\"behavior\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    subject.addObservable(<span class=\"string\">\"ç¬¬ä¸€ä¸ªå“åº”\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    subject.onNext(<span class=\"string\">\"ç¬¬ä¸€ä¸ªäº‹ä»¶\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    subject.onNext(<span class=\"string\">\"ç¬¬äºŒä¸ªäº‹ä»¶\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    subject.addObservable(<span class=\"string\">\"ç¬¬äºŒä¸ªå“åº”\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    subject.onNext(<span class=\"string\">\"ç¬¬ä¸‰ä¸ªäº‹ä»¶\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    subject.onNext(<span class=\"string\">\"ç¬¬å››ä¸ªäº‹ä»¶\"</span>)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>æ‰“å°ç»“æœ</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div></pre></td><td class=\"code\"><pre><div class=\"line\">------exampleOf:BehaviorSubject------</div><div class=\"line\">Subscription: ç¬¬ä¸€ä¸ªå“åº” Event: next(behavior)</div><div class=\"line\">Subscription: ç¬¬ä¸€ä¸ªå“åº” Event: next(ç¬¬ä¸€ä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: ç¬¬ä¸€ä¸ªå“åº” Event: next(ç¬¬äºŒä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: ç¬¬äºŒä¸ªå“åº” Event: next(ç¬¬äºŒä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: ç¬¬ä¸€ä¸ªå“åº” Event: next(ç¬¬ä¸‰ä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: ç¬¬äºŒä¸ªå“åº” Event: next(ç¬¬ä¸‰ä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: ç¬¬ä¸€ä¸ªå“åº” Event: next(ç¬¬å››ä¸ªäº‹ä»¶)</div><div class=\"line\">Subscription: ç¬¬äºŒä¸ªå“åº” Event: next(ç¬¬å››ä¸ªäº‹ä»¶)</div></pre></td></tr></table></figure>\n<h2 id=\"Variable\"><a href=\"#Variable\" class=\"headerlink\" title=\"Variable\"></a>Variable</h2><p>Variableæ˜¯BehaviorSubjectçš„ä¸€å±‚å°è£…ã€‚ç‰¹ç‚¹ä¸ä¼šè¢«æ˜¾å¼ç»ˆç»“ã€‚å³ï¼šä¸ä¼šæ”¶åˆ° .Completed å’Œ .Error è¿™ç±»çš„ç»ˆç»“äº‹ä»¶ï¼Œå®ƒä¼šä¸»åŠ¨åœ¨ææ„çš„æ—¶å€™å‘é€ .Complete ã€‚</p>\n<figure class=\"highlight swift\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div><div class=\"line\">12</div><div class=\"line\">13</div><div class=\"line\">14</div><div class=\"line\">15</div><div class=\"line\">16</div><div class=\"line\">17</div><div class=\"line\">18</div></pre></td><td class=\"code\"><pre><div class=\"line\">exampleOf(description: <span class=\"string\">\"Variable\"</span>) &#123; </div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> disposeBag = <span class=\"type\">DisposeBag</span>()</div><div class=\"line\">    </div><div class=\"line\">    <span class=\"keyword\">let</span> variable = <span class=\"type\">Variable</span>&lt;<span class=\"type\">String</span>&gt;(<span class=\"string\">\"é»˜è®¤å€¼\"</span>)</div><div class=\"line\">    </div><div class=\"line\">    variable.asObservable().addObservable(<span class=\"string\">\"no.1\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    variable.value = <span class=\"string\">\"ç¬¬äºŒä¸ªå€¼\"</span></div><div class=\"line\">    </div><div class=\"line\">    variable.value = <span class=\"string\">\"ç¬¬ä¸‰ä¸ªå€¼\"</span></div><div class=\"line\">    </div><div class=\"line\">    variable.asObservable().addObservable(<span class=\"string\">\"no.2\"</span>).disposed(by: disposeBag)</div><div class=\"line\">    </div><div class=\"line\">    variable.value = <span class=\"string\">\"ç¬¬å››ä¸ªå€¼\"</span></div><div class=\"line\">    </div><div class=\"line\">    variable.value = <span class=\"string\">\"ç¬¬äº”ä¸ªå€¼\"</span></div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>æ‰“å°ç»“æœ</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><div class=\"line\">1</div><div class=\"line\">2</div><div class=\"line\">3</div><div class=\"line\">4</div><div class=\"line\">5</div><div class=\"line\">6</div><div class=\"line\">7</div><div class=\"line\">8</div><div class=\"line\">9</div><div class=\"line\">10</div><div class=\"line\">11</div></pre></td><td class=\"code\"><pre><div class=\"line\">------exampleOf:Variable------</div><div class=\"line\">Subscription: no.1 Event: next(é»˜è®¤å€¼)</div><div class=\"line\">Subscription: no.1 Event: next(ç¬¬äºŒä¸ªå€¼)</div><div class=\"line\">Subscription: no.1 Event: next(ç¬¬ä¸‰ä¸ªå€¼)</div><div class=\"line\">Subscription: no.2 Event: next(ç¬¬ä¸‰ä¸ªå€¼)</div><div class=\"line\">Subscription: no.1 Event: next(ç¬¬å››ä¸ªå€¼)</div><div class=\"line\">Subscription: no.2 Event: next(ç¬¬å››ä¸ªå€¼)</div><div class=\"line\">Subscription: no.1 Event: next(ç¬¬äº”ä¸ªå€¼)</div><div class=\"line\">Subscription: no.2 Event: next(ç¬¬äº”ä¸ªå€¼)</div><div class=\"line\">Subscription: no.1 Event: completed</div><div class=\"line\">Subscription: no.2 Event: completed</div></pre></td></tr></table></figure>\n<ul>\n<li>Demoåœ°å€<a href=\"https://github.com/RockyAo/RxSwift_learn\" target=\"_blank\" rel=\"external\">https://github.com/RockyAo/RxSwift_learn</a>.æˆ–è€…ç›´æ¥çœ‹å®˜æ–¹çš„demo</li>\n</ul>\n","prev":{"title":"è®¾è®¡æ¨¡å¼å­¦ä¹ -è®¾è®¡åŸåˆ™","slug":"è®¾è®¡æ¨¡å¼-è®¾è®¡åŸåˆ™"},"next":{"title":"RxSwiftï¼ˆä¸€ï¼‰Creating and Subscribing to Observables åˆ›å»ºå’Œè®¢é˜…è§‚å¯Ÿè€…","slug":"RxSwiftï¼ˆä¸€ï¼‰Creating and Subscribing to Observables åˆ›å»ºå’Œè®¢é˜…è§‚å¯Ÿè€…"}}